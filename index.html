<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Agorapulse Micronaut Libaries</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="css/micronaut-libraries.css?v=1.0.1.RC1" />
<style>
.hidden {
	display: none;
}

.switch {
	border-width: 1px 1px 0 1px;
	border-style: solid;
	border-color: #7a2518;
	display: inline-block;
}

.switch--item {
	padding: 10px;
	background-color: #ffffff;
	color: #7a2518;
	display: inline-block;
	cursor: pointer;
}

.switch--item:not(:first-child) {
	border-width: 0 0 0 1px;
	border-style: solid;
	border-color: #7a2518;
}

.switch--item.selected {
	background-color: #7a2519;
	color: #ffffff;
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
	$('.primary').each(function() {
		primary = $(this);
		createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
		primary.children('.title').remove();
	});
	$('.secondary').each(function(idx, node) {
		secondary = $(node);
		primary = findPrimary(secondary);
		switchItem = createSwitchItem(secondary, primary.children('.switch'));
		switchItem.content.addClass('hidden');
		findPrimary(secondary).append(switchItem.content);
		secondary.remove();
	});
}

function createBlockSwitch(primary) {
	blockSwitch = $('<div class="switch"></div>');
	primary.prepend(blockSwitch);
	return blockSwitch;
}

function findPrimary(secondary) {
	candidate = secondary.prev();
	while (!candidate.is('.primary')) {
		candidate = candidate.prev();
	}
	return candidate;
}

function createSwitchItem(block, blockSwitch) {
	blockName = block.children('.title').text();
	content = block.children('.content').first().append(block.next('.colist'));
	item = $('<div class="switch--item">' + blockName + '</div>');
	item.on('click', '', content, function(e) {
		$(this).addClass('selected');
		$(this).siblings().removeClass('selected');
		e.data.siblings('.content').addClass('hidden');
		e.data.removeClass('hidden');
	});
	blockSwitch.append(item);
	return {'item': item, 'content': content};
}

$(addBlockSwitches);
</script>

</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Agorapulse Micronaut Libaries</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_micronaut_grails">Micronaut Grails</a>
<ul class="sectlevel2">
<li><a href="#_installation">Installation</a></li>
<li><a href="#_usage">Usage</a></li>
</ul>
</li>
<li><a href="#_aws_sdk_for_micronaut">AWS SDK for Micronaut</a>
<ul class="sectlevel2">
<li><a href="#_installation_2">Installation</a></li>
<li><a href="#_dynamodb">DynamoDB</a>
<ul class="sectlevel3">
<li><a href="#_declarative_services_with_service">Declarative Services with <code>@Service</code></a>
<ul class="sectlevel4">
<li><a href="#_method_signatures">Method Signatures</a></li>
<li><a href="#_advanced_queries">Advanced Queries</a></li>
<li><a href="#_scanning">Scanning</a></li>
<li><a href="#_updates">Updates</a></li>
</ul>
</li>
<li><a href="#_dynamodb_service">DynamoDB Service</a></li>
<li><a href="#_testing">Testing</a></li>
</ul>
</li>
<li><a href="#_kinesis">Kinesis</a>
<ul class="sectlevel3">
<li><a href="#_configuration">Configuration</a></li>
<li><a href="#_publishing_with_kinesisclient">Publishing with <code>@KinesisClient</code></a></li>
<li><a href="#_listening_with_kinesislistener">Listening with <code>@KinesisListener</code></a></li>
<li><a href="#_kinesis_service">Kinesis Service</a></li>
<li><a href="#_testing_2">Testing</a></li>
</ul>
</li>
<li><a href="#_simple_storage_service_s3">Simple Storage Service (S3)</a>
<ul class="sectlevel3">
<li><a href="#_configuration_2">Configuration</a></li>
<li><a href="#_simple_storage_service">Simple Storage Service</a></li>
<li><a href="#_testing_3">Testing</a></li>
</ul>
</li>
<li><a href="#_simple_email_service_ses">Simple Email Service (SES)</a>
<ul class="sectlevel3">
<li><a href="#_simple_email_service">Simple Email Service</a></li>
<li><a href="#_testing_4">Testing</a></li>
</ul>
</li>
<li><a href="#_simple_notification_service_sns">Simple Notification Service (SNS)</a>
<ul class="sectlevel3">
<li><a href="#_configuration_3">Configuration</a></li>
<li><a href="#_publishing_with_notificationclient">Publishing with <code>@NotificationClient</code></a></li>
<li><a href="#_simple_notification_service">Simple Notification Service</a>
<ul class="sectlevel4">
<li><a href="#_working_with_topics">Working with Topics</a></li>
<li><a href="#_working_with_applications">Working with Applications</a></li>
<li><a href="#_sending_sms">Sending SMS</a></li>
</ul>
</li>
<li><a href="#_testing_5">Testing</a></li>
</ul>
</li>
<li><a href="#_simple_queue_service_sqs">Simple Queue Service (SQS)</a>
<ul class="sectlevel3">
<li><a href="#_configuration_4">Configuration</a></li>
<li><a href="#_publishing_with_queueclient">Publishing with <code>@QueueClient</code></a></li>
<li><a href="#_simple_queue_service">Simple Queue Service</a></li>
<li><a href="#_testing_6">Testing</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_maintained_by">Maintained by</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock ribbon">
<div class="content">
<a class="image" href="https://github.com/agorapulse/micronaut-libraries"><img src="images/ribbon.png" alt="ribbon"></a>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://bintray.com/agorapulse/libs/micronaut-http-server-basic/_latestVersion"><img src="https://api.bintray.com/packages/agorapulse/libs/micronaut-http-server-basic/images/download.svg" alt="download"></a>
</div>
</div>
<div class="paragraph">
<p>Set of useful libraries for <a href="http://micronaut.io">Micronaut</a>. All of the libraries are available in <a href="https://bintray.com/bintray/jcenter">JCenter Maven repository</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_micronaut_grails">Micronaut Grails</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut Grails package helps using Micronaut beans in the Grails application. There are two additional features which
cannot be found the official <a href="https://docs.micronaut.io/latest/guide/index.html#springBeans">Spring support for Micronaut</a>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Micronaut beans' names defaults to lower-cased simple name of the class as expected by Grails</p>
</li>
<li>
<p>Ability to reuse existing properties declared by Grails - e.g. <code>grails.redis.port</code> can be injected as <code>@Value('${redis.port}')</code></p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_installation">Installation</h3>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code>compileOnly 'com.agorapulse:micronaut-grails:1.0.1.RC1'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-grails&lt;/artifactId&gt;
    &lt;version&gt;1.0.1.RC1&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you plan to reuse same library for Micronaut and Grails, you can declare the dependency as  <code>compileOnly</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_usage">Usage</h3>
<div class="paragraph">
<p>The integration is handle by bean processor which needs to be injected into Spring application context. The easiest
thing is to create Spring configuration placed next to your Micronaut classes. The Spring configuration class will
create the processor bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-groovy hljs" data-lang="groovy">@CompileStatic
@Configuration                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
class GrailsConfig {

    @Bean
    GrailsMicronautBeanProcessor widgetProcessor() {                                    <i class="conum" data-value="2"></i><b>(2)</b>
        GrailsMicronautBeanProcessor
            .builder()                                                                  <i class="conum" data-value="3"></i><b>(3)</b>
            .addByType(Widget)                                                          <i class="conum" data-value="4"></i><b>(4)</b>
            .addByType('someInterface', SomeInterface)                                  <i class="conum" data-value="5"></i><b>(5)</b>
            .addByStereotype('prototype', Prototype)                                    <i class="conum" data-value="6"></i><b>(6)</b>
            .addByName('gadget')                                                        <i class="conum" data-value="7"></i><b>(7)</b>
            .addByName('one')
            .addByName('two')
            .addByQualifiers(                                                           <i class="conum" data-value="8"></i><b>(8)</b>
                'otherMinion',
                Qualifiers.byName('other'),
                Qualifiers.byType(Minion)
            )
            .build()
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define class as Spring <code>@Configuration</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare method which returns bean processor <code>@Bean</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use builder to add all exported beans to the Spring application context</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The name of the Spring bean defaults to the <em>property name</em> of the class, e.g. <code>widget</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can provide different name</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can qualify using a stereotype (annotation)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can qualify using the name of the bean which will be the same in the Spring application</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>You can combine any qualifiers possible to narrow the search to single bean which needs to be available from the Spring application context</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If more then one bean qualifies the criteria then an exception will be thrown.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have your configuration class ready then you can create <code>META-INF/spring.factories</code> descriptor in resources folder
which will automatically load the configuration once the JAR is on classpath.</p>
</div>
<div class="listingblock">
<div class="title">META-INF/spring.factories</div>
<div class="content">
<pre>org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.agorapulse.micronaut.grails.example.GrailsConfig</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aws_sdk_for_micronaut">AWS SDK for Micronaut</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AWS SDK for Micronaut is a successor of <a href="https://github.com/agorapulse/grails-aws-sdk">Grails AWS SDK Plugin</a>.
If you are <a href="https://github.com/agorapulse/grails-aws-sdk">Grails AWS SDK Plugin</a> user you should find many of services familiar.</p>
</div>
<div class="paragraph">
<p>Provided integrations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_dynamodb">DynamoDB</a></p>
</li>
<li>
<p><a href="#_kinesis">Kinesis</a></p>
</li>
<li>
<p><a href="#_simple_storage_service_s3">Simple Storage Service (S3)</a></p>
</li>
<li>
<p><a href="#_simple_email_service_ses">Simple Email Service (SES)</a></p>
</li>
<li>
<p><a href="#_simple_notification_service_sns">Simple Notification Service (SNS)</a></p>
</li>
<li>
<p><a href="#_simple_queue_service_sqs">Simple Queue Service (SQS)</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="#API Gateway Proxy Integration">[API Gateway Proxy Integration]</a> is handled separately in its own library.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Key concepts of the AWS SDK for Micronaut:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fully leveraging of Micronaut best practises</p>
<div class="ulist">
<ul>
<li>
<p>Low-level API clients such as <code>AmazonDynamoDB</code> available for dependency injection</p>
</li>
<li>
<p>Declarative clients and services such as <code>@KinesisListener</code> where applicable</p>
</li>
<li>
<p>Configuration driven named service beans</p>
</li>
<li>
<p>Sensible defaults</p>
</li>
<li>
<p>Conditional beans based on presence of classes on the classpath or on the presence of specific properties</p>
</li>
</ul>
</div>
</li>
<li>
<p>Fully leveraging existing AWS SDK configuration chains (e.g. <a href="https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/auth/DefaultAWSCredentialsProviderChain.html">default credential provider chain</a>, <a href="https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/regions/DefaultAwsRegionProviderChain.html">default region provider chain</a>)</p>
</li>
<li>
<p>Strong focus on the ease of testing</p>
<div class="ulist">
<ul>
<li>
<p>Low-level API clients such as <code>AmazonDynamoDB</code> injected by Micronaut and overridable in the tests</p>
</li>
<li>
<p>All high-level services hidden behind an interface for easy mocking in the tests</p>
</li>
<li>
<p>Declarative clients and services for easy mocking in the tests</p>
</li>
</ul>
</div>
</li>
<li>
<p>Java-enabled but Groovy is a first-class citizen</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this documentation, the high-level approaches will be discussed first before the lower-level services.</p>
</div>
<div class="sect2">
<h3 id="_installation_2">Installation</h3>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code>compile 'com.agorapulse:micronaut-aws-sdk:1.0.1.RC1'

// only required for DynamoDB and Kinesis integration
compile group: 'com.amazonaws', name: 'aws-java-sdk-dynamodb', version: '1.11.470'

// only required for Kinesis integration
compile group: 'com.amazonaws', name: 'amazon-kinesis-client', version: '1.9.3'
compile group: 'com.amazonaws', name: 'aws-java-sdk-kinesis', version: '1.11.470'

// only required for S3 integration
compile group: 'com.amazonaws', name: 'aws-java-sdk-s3', version: '1.11.470'

// only required for SES integration
compile group: 'com.amazonaws', name: 'aws-java-sdk-ses', version: '1.11.470'

// only required for SNS integration
compile group: 'com.amazonaws', name: 'aws-java-sdk-sns', version: '1.11.470'

// only required for SQS integration
compile group: 'com.amazonaws', name: 'aws-java-sdk-sqs', version: '1.11.470'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-aws-sdk&lt;/artifactId&gt;
    &lt;version&gt;1.0.1.RC1&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- only required for DynamoDB and Kinesis integration --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;aws-java-sdk-dynamodb&lt;/artifactId&gt;
    &lt;version&gt;1.11.470&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- only required for Kinesis integration --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;amazon-kinesis-client&lt;/artifactId&gt;
    &lt;version&gt;1.9.3&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;aws-java-sdk-kinesis&lt;/artifactId&gt;
    &lt;version&gt;1.11.470&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- only required for S3 integration --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;aws-java-sdk-s3&lt;/artifactId&gt;
    &lt;version&gt;1.11.470&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- only required for SES integration --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;aws-java-sdk-ses&lt;/artifactId&gt;
    &lt;version&gt;1.11.470&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- only required for SNS integration --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;aws-java-sdk-sns&lt;/artifactId&gt;
    &lt;version&gt;1.11.470&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- only required for SQS integration --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;aws-java-sdk-sqs&lt;/artifactId&gt;
    &lt;version&gt;1.11.470&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dynamodb">DynamoDB</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon DynamoDB is a fully managed NoSQL database service that provides fast and predictable performance with seamless scalability.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides two approaches to work with DynamoDB tables and entities:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>High-level <a href="#_declarative_services_with_service">Declarative Services with <code>@Service</code></a></p>
</li>
<li>
<p>Middle-level <a href="#_dynamodb_service">DynamoDB Service</a></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_declarative_services_with_service">Declarative Services with <code>@Service</code></h4>
<div class="paragraph">
<p>Declarative services are very similar to <a href="http://gorm.grails.org/6.1.x/hibernate/manual/#dataServices">Grails GORM Data Services</a>.
If you place <code>com.agorapulse.micronaut.aws.dynamodb.annotation.Service</code> annotation on the interface then methods
matching predefined pattern will be automatically implemented.</p>
</div>
<div class="sect4">
<h5 id="_method_signatures">Method Signatures</h5>
<div class="paragraph">
<p>The following example shows many of available method signatures:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-groovy hljs" data-lang="groovy">@Service(DynamoDBEntity)
interface DynamoDBItemDBService {

    DynamoDBEntity get(String hash, String rangeKey)
    DynamoDBEntity load(String hash, String rangeKey)
    List&lt;DynamoDBEntity&gt; getAll(String hash, List&lt;String&gt; rangeKeys)
    List&lt;DynamoDBEntity&gt; getAll(String hash, String... rangeKeys)
    List&lt;DynamoDBEntity&gt; loadAll(String hash, List&lt;String&gt; rangeKeys)
    List&lt;DynamoDBEntity&gt; loadAll(String hash, String... rangeKeys)

    DynamoDBEntity save(DynamoDBEntity entity)
    List&lt;DynamoDBEntity&gt; saveAll(DynamoDBEntity... entities)
    List&lt;DynamoDBEntity&gt; saveAll(Iterable&lt;DynamoDBEntity&gt; entities)

    int count(String hashKey)
    int count(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range {
                eq DynamoDBEntity.RANGE_INDEX, rangeKey
            }
        }
    })
    int countByRangeIndex(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range { between DynamoDBEntity.DATE_INDEX, after, before }
        }
    })
    int countByDates(String hashKey, Date after, Date before)

    Flowable&lt;DynamoDBEntity&gt; query(String hashKey)
    Flowable&lt;DynamoDBEntity&gt; query(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range {
                eq DynamoDBEntity.RANGE_INDEX, rangeKey
            }
            only {
                rangeIndex
            }
        }
    })
    Flowable&lt;DynamoDBEntity&gt; queryByRangeIndex(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range { between DynamoDBEntity.DATE_INDEX, after, before }
        }
    })
    Flowable&lt;DynamoDBEntity&gt; queryByDates(String hashKey, Date after, Date before)

    void delete(DynamoDBEntity entity)
    void delete(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range {
                eq DynamoDBEntity.RANGE_INDEX, rangeKey
            }
        }
    })
    int deleteByRangeIndex(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range { between DynamoDBEntity.DATE_INDEX, after, before }
        }
    })
    int deleteByDates(String hashKey, Date after, Date before)

    @Update({
        update(DynamoDBEntity) {
            hash hashKey
            range rangeKey
            add 'number', 1
            returnUpdatedNew { number }
        }
    })
    Number increment(String hashKey, String rangeKey)

    @Update({
        update(DynamoDBEntity) {
            hash hashKey
            range rangeKey
            add 'number', -1
            returnUpdatedNew { number }
        }
    })
    Number decrement(String hashKey, String rangeKey)

    @Scan({
        scan(DynamoDBEntity) {
            filter {
                eq DynamoDBEntity.RANGE_INDEX, foo
            }
        }
    })
    Flowable&lt;DynamoDBEntity&gt; scanAllByRangeIndex(String foo)

}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">@Service(DynamoDBEntity.class)
public interface DynamoDBEntityService {

    class EqRangeIndex implements Function&lt;Map&lt;String, Object&gt;, DetachedQuery&gt; {
        public DetachedQuery apply(Map&lt;String, Object&gt; arguments) {
            return Builders.query(DynamoDBEntity.class)
                .hash(arguments.get("hashKey"))
                .range(r -&gt; r.eq(DynamoDBEntity.RANGE_INDEX, arguments.get("rangeKey")));
        }
    }

    class EqRangeProjection implements Function&lt;Map&lt;String, Object&gt;, DetachedQuery&gt; {
        public DetachedQuery apply(Map&lt;String, Object&gt; arguments) {
            return Builders.query(DynamoDBEntity.class)
                .hash(arguments.get("hashKey"))
                .range(r -&gt;
                    r.eq(DynamoDBEntity.RANGE_INDEX, arguments.get("rangeKey"))
                )
                .only(DynamoDBEntity.RANGE_INDEX);
        }
    }

    class EqRangeScan implements Function&lt;Map&lt;String, Object&gt;, DetachedScan&gt; {
        public DetachedScan apply(Map&lt;String, Object&gt; arguments) {
            return Builders.scan(DynamoDBEntity.class)
                .filter(f -&gt; f.eq(DynamoDBEntity.RANGE_INDEX, arguments.get("foo")));
        }
    }

    class BetweenDateIndex implements Function&lt;Map&lt;String, Object&gt;, DetachedQuery&gt; {
        public DetachedQuery apply(Map&lt;String, Object&gt; arguments) {
            return Builders.query(DynamoDBEntity.class)
                .hash(arguments.get("hashKey"))
                .range(r -&gt; r.between(DynamoDBEntity.DATE_INDEX, arguments.get("after"), arguments.get("before")));
        }
    }

    class IncrementNumber implements Function&lt;Map&lt;String, Object&gt;, DetachedUpdate&gt; {
        public DetachedUpdate apply(Map&lt;String, Object&gt; arguments) {
            return Builders.update(DynamoDBEntity.class)
                .hash(arguments.get("hashKey"))
                .range(arguments.get("rangeKey"))
                .add("number", 1)
                .returnUpdatedNew(DynamoDBEntity::getNumber);
        }
    }

    class DecrementNumber implements Function&lt;Map&lt;String, Object&gt;, DetachedUpdate&gt; {
        public DetachedUpdate apply(Map&lt;String, Object&gt; arguments) {
            return Builders.update(DynamoDBEntity.class)
                .hash(arguments.get("hashKey"))
                .range(arguments.get("rangeKey"))
                .add("number", -1)
                .returnUpdatedNew(DynamoDBEntity::getNumber);
        }
    }

    DynamoDBEntity get(String hash, String rangeKey);

    DynamoDBEntity load(String hash, String rangeKey);

    List&lt;DynamoDBEntity&gt; getAll(String hash, List&lt;String&gt; rangeKeys);

    List&lt;DynamoDBEntity&gt; getAll(String hash, String... rangeKeys);

    List&lt;DynamoDBEntity&gt; loadAll(String hash, List&lt;String&gt; rangeKeys);

    List&lt;DynamoDBEntity&gt; loadAll(String hash, String... rangeKeys);

    DynamoDBEntity save(DynamoDBEntity entity);

    List&lt;DynamoDBEntity&gt; saveAll(DynamoDBEntity... entities);

    List&lt;DynamoDBEntity&gt; saveAll(Iterable&lt;DynamoDBEntity&gt; entities);

    int count(String hashKey);

    int count(String hashKey, String rangeKey);

    @Query(EqRangeIndex.class)
    int countByRangeIndex(String hashKey, String rangeKey);

    @Query(BetweenDateIndex.class)
    int countByDates(String hashKey, Date after, Date before);

    Flowable&lt;DynamoDBEntity&gt; query(String hashKey);

    Flowable&lt;DynamoDBEntity&gt; query(String hashKey, String rangeKey);

    @Query(EqRangeProjection.class)
    Flowable&lt;DynamoDBEntity&gt; queryByRangeIndex(String hashKey, String rangeKey);

    @Query(BetweenDateIndex.class)
    Flowable&lt;DynamoDBEntity&gt; queryByDates(String hashKey, Date after, Date before);

    void delete(DynamoDBEntity entity);

    void delete(String hashKey, String rangeKey);

    @Query(EqRangeIndex.class)
    int deleteByRangeIndex(String hashKey, String rangeKey);

    @Query(BetweenDateIndex.class)
    int deleteByDates(String hashKey, Date after, Date before);

    @Update(IncrementNumber.class)
    Number increment(String hashKey, String rangeKey);

    @Update(DecrementNumber.class)
    Number decrement(String hashKey, String rangeKey);

    @Scan(EqRangeScan.class)
    Flowable&lt;DynamoDBEntity&gt; scanAllByRangeIndex(String foo);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table summarizes the supported method signatures:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Basic Service Methods</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Return Type</th>
<th class="tableblock halign-left valign-top">Method Name</th>
<th class="tableblock halign-left valign-top">Arguments</th>
<th class="tableblock halign-left valign-top">Example</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T</code></p>
<p class="tableblock">    <code>List&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>save*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An entity, array of entities or iterable of entities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DynamoDBEntity save(DynamoDBEntity entity)</code></p>
<p class="tableblock">    <code>List&lt;DynamoDBEntity&gt; saveAll(DynamoDBEntity&#8230;&#8203; entities)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Perists the entity or a list of entities and returns self</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T</code></p>
<p class="tableblock">    <code>List&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get*</code>, <code>load*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash key and optional range key, array of range keys or iterable of range keys annotated with <code>@HashKey</code> and <code>@RangeKey</code> if the argument name does not contain word <code>hash</code> or <code>range</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DynamoDBEntity load(String hashKey);</code></p>
<p class="tableblock">    <code>List&lt;DynamoDBEntity&gt; getAll(@HashKey String parentId, String&#8230;&#8203; rangeKeys);</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loads a single entity or a list of entities from the table. Range key is required for tables which defines the range key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>count*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash key and optional range key annotated with <code>@HashKey</code> and <code>@RangeKey</code> if the argument name does not contain word <code>hash</code> or <code>range</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int count(String hashKey)</code></p>
<p class="tableblock">    <code>int count(@HashKey String parentId, String rangeKey)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the items in the database. Beware, this can be very expensive operation in DynamoDB. See <a href="#_advanced_queries">Advanced Queries</a> for advanced use cases</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delete*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entity or Hash key and optional range key annotated with <code>@HashKey</code> and <code>@RangeKey</code> if the argument name does not contain word <code>hash</code> or <code>range</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void delete(DynamoDBEntity entity)</code></p>
<p class="tableblock">    <code>void delete(String hashKey, String rangeKey)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deletes an item which can be specified with hash key and optional range key. See <a href="#_advanced_queries">Advanced Queries</a> for advanced use cases</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>list*</code></p>
<p class="tableblock"><code>findAll*</code></p>
<p class="tableblock"><code>query*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entity or Hash key and optional range key annotated with <code>@HashKey</code> and <code>@RangeKey</code> if the argument name does not contain word <code>hash</code> or <code>range</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;DynamoDBEntity&gt; query(String hashKey)</code></p>
<p class="tableblock">    <code>Flowable&lt;DynamoDBEntity&gt; query(String hashKey, String rangeKey)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Queries for all entities with given hash key and/or range key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(contextual)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(none of above)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any arguments which will be translated into arguments map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(see below)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query, scan or update. See <a href="#_advanced_queries">Advanced Queries</a>, <a href="#_scanning">Scanning</a> and <a href="#_updates">Updates</a> for advanced use cases</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Calling any of the declarative service method will create the DynamoDB table automatically if it does not exist already.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_advanced_queries">Advanced Queries</h5>
<div class="paragraph">
<p>DynamoDB integration does not support feature known as <a href="http://gorm.grails.org/6.0.x/hibernate/manual/index.html#finders"><em>dynamic finders</em></a>.
Instead you can annotate any method with <code>@Query</code> annotation to make it</p>
</div>
<div class="ulist">
<ul>
<li>
<p>counting method if its name begins with <code>count</code></p>
</li>
<li>
<p>batch delete method if its name begins with <code>delete</code></p>
</li>
<li>
<p>otherwise an advanced query method</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-groovy hljs" data-lang="groovy">import static com.agorapulse.micronaut.aws.dynamodb.builder.Builders.*                  <i class="conum" data-value="1"></i><b>(1)</b>


@Service(DynamoDBEntity)                                                                <i class="conum" data-value="2"></i><b>(2)</b>
interface DynamoDBItemDBService {

    @Query({                                                                            <i class="conum" data-value="3"></i><b>(3)</b>
        query(DynamoDBEntity) {
            hash hashKey                                                                <i class="conum" data-value="4"></i><b>(4)</b>
            range {
                eq DynamoDBEntity.RANGE_INDEX, rangeKey                                 <i class="conum" data-value="5"></i><b>(5)</b>
            }
            only {                                                                      <i class="conum" data-value="6"></i><b>(6)</b>
                rangeIndex                                                              <i class="conum" data-value="7"></i><b>(7)</b>
            }
        }
    })
    Flowable&lt;DynamoDBEntity&gt; queryByRangeIndex(String hashKey, String rangeKey)         <i class="conum" data-value="8"></i><b>(8)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Builders</code> class provides all necessary factory methods and keywords</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@Query</code> annotation accepts a closure which returns a query builder (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/QueryBuilder.html">QueryBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify a hash key with <code>hash</code> method and method&#8217;s <code>hashKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify some range key criteria with the method&#8217;s <code>rangeKey</code> argument (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/RangeConditionCollector.html">RangeConditionCollector</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can limit which properties are returned from the query</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Only <code>rangeIndex</code> property will be populated in the entities returned</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The arguments have no special meaning but you can use them in the query. The method must return <code>Flowable</code> of entities.</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">@Service(DynamoDBEntity.class)                                                          <i class="conum" data-value="1"></i><b>(1)</b>
public interface DynamoDBEntityService {

    class EqRangeProjection implements Function&lt;Map&lt;String, Object&gt;, DetachedQuery&gt; {   <i class="conum" data-value="2"></i><b>(2)</b>
        public DetachedQuery apply(Map&lt;String, Object&gt; arguments) {
            return Builders.query(DynamoDBEntity.class)                                 <i class="conum" data-value="3"></i><b>(3)</b>
                .hash(arguments.get("hashKey"))                                         <i class="conum" data-value="4"></i><b>(4)</b>
                .range(r -&gt;
                    r.eq(DynamoDBEntity.RANGE_INDEX, arguments.get("rangeKey"))         <i class="conum" data-value="5"></i><b>(5)</b>
                )
                .only(DynamoDBEntity.RANGE_INDEX);                                      <i class="conum" data-value="6"></i><b>(6)</b>
        }
    }

    @Query(EqRangeProjection.class)                                                     <i class="conum" data-value="7"></i><b>(7)</b>
    Flowable&lt;DynamoDBEntity&gt; queryByRangeIndex(String hashKey, String rangeKey);        <i class="conum" data-value="8"></i><b>(8)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedQuery&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use <code>Builders</code> class to create a query builder for given DynamoDB entity (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/QueryBuilder.html">QueryBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify a hash key with <code>hash</code> method and method&#8217;s <code>hashKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify some range key criteria with the method&#8217;s <code>rangeKey</code> argument (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/RangeConditionCollector.html">RangeConditionCollector</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Only <code>rangeIndex</code> property will be populated in the entities returned</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><code>@Query</code> annotation accepts a class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedQuery&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The arguments have no special meaning but you can use them in the query using <code>arguments</code> map. The method must return <code>Flowable</code> of entities.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_scanning">Scanning</h5>
<div class="paragraph">
<p>DynamoDB integration does not support feature known as <a href="http://gorm.grails.org/6.0.x/hibernate/manual/index.html#finders"><em>dynamic finders</em></a>.
If you need to scan the table by unindexed attributes you can annotate any method with <code>@scan</code> annotation to make it</p>
</div>
<div class="ulist">
<ul>
<li>
<p>counting method if its name begins with <code>count</code></p>
</li>
<li>
<p>otherwise an advanced query method</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-groovy hljs" data-lang="groovy">import static com.agorapulse.micronaut.aws.dynamodb.builder.Builders.*                  <i class="conum" data-value="1"></i><b>(1)</b>


@Service(DynamoDBEntity)                                                                <i class="conum" data-value="2"></i><b>(2)</b>
interface DynamoDBItemDBService {

    @Scan({                                                                             <i class="conum" data-value="3"></i><b>(3)</b>
        scan(DynamoDBEntity) {
            filter {
                eq DynamoDBEntity.RANGE_INDEX, foo                                      <i class="conum" data-value="4"></i><b>(4)</b>
            }
        }
    })
    Flowable&lt;DynamoDBEntity&gt; scanAllByRangeIndex(String foo)                            <i class="conum" data-value="5"></i><b>(5)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Builders</code> class provides all necessary factory methods and keywords</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@Scan</code> annotation accepts a closure which returns a scan builder (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/ScanBuilder.html">ScanBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify some filter criteria with the method&#8217;s <code>foo</code> argument (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/RangeConditionCollector.html">RangeConditionCollector</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The arguments have no special meaning but you can use them in the scan definition. The method must return <code>Flowable</code> of entities.</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">@Service(DynamoDBEntity.class)                                                          <i class="conum" data-value="1"></i><b>(1)</b>
public interface DynamoDBEntityService {

    class EqRangeScan implements Function&lt;Map&lt;String, Object&gt;, DetachedScan&gt; {          <i class="conum" data-value="2"></i><b>(2)</b>
        public DetachedScan apply(Map&lt;String, Object&gt; arguments) {
            return Builders.scan(DynamoDBEntity.class)                                  <i class="conum" data-value="3"></i><b>(3)</b>
                .filter(f -&gt; f.eq(DynamoDBEntity.RANGE_INDEX, arguments.get("foo")));   <i class="conum" data-value="4"></i><b>(4)</b>
        }
    }

    @Scan(EqRangeScan.class)                                                            <i class="conum" data-value="5"></i><b>(5)</b>
    Flowable&lt;DynamoDBEntity&gt; scanAllByRangeIndex(String foo);                           <i class="conum" data-value="6"></i><b>(6)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedScan&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use <code>Builders</code> class to create a scan builder for given DynamoDB entity (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/ScanBuilder.html">ScanBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify some filter criteria with the method&#8217;s <code>foo</code> argument (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/RangeConditionCollector.html">RangeConditionCollector</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>@Scan</code> annotation accepts a class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedScan&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The arguments have no special meaning but you can use them in the scan definition. The method must return <code>Flowable</code> of entities.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_updates">Updates</h5>
<div class="paragraph">
<p>Declarative services allows you to execute fine-grained updates. Any method annotated with <code>@Update</code> will perform the update in the DynamoDB table.</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-groovy hljs" data-lang="groovy">import static com.agorapulse.micronaut.aws.dynamodb.builder.Builders.*                  <i class="conum" data-value="1"></i><b>(1)</b>


@Service(DynamoDBEntity)                                                                <i class="conum" data-value="2"></i><b>(2)</b>
interface DynamoDBItemDBService {

    @Update({                                                                           <i class="conum" data-value="3"></i><b>(3)</b>
        update(DynamoDBEntity) {
            hash hashKey                                                                <i class="conum" data-value="4"></i><b>(4)</b>
            range rangeKey                                                              <i class="conum" data-value="5"></i><b>(5)</b>
            add 'number', 1                                                             <i class="conum" data-value="6"></i><b>(6)</b>
            returnUpdatedNew { number }                                                 <i class="conum" data-value="7"></i><b>(7)</b>
        }
    })
    Number increment(String hashKey, String rangeKey)                                   <i class="conum" data-value="8"></i><b>(8)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Builders</code> class provides all necessary factory methods and keywords</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@Update</code> annotation accepts a closure which returns an update builder (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify a hash key with <code>hash</code> method and method&#8217;s <code>hashKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify a range key with <code>range</code> method and method&#8217;s <code>rangeKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify update operation - increment <code>number</code> attribute (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference). You may have multiple update operations.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Specify what should be returned from the method (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference).</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The arguments have no special meaning but you can use them in the scan definition. The method&#8217;s return value depends on the value returned from <code>returnUpdatedNew</code> mapper.</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">@Service(DynamoDBEntity.class)                                                          <i class="conum" data-value="1"></i><b>(1)</b>
public interface DynamoDBEntityService {

    class IncrementNumber implements Function&lt;Map&lt;String, Object&gt;, DetachedUpdate&gt; {    <i class="conum" data-value="2"></i><b>(2)</b>
        public DetachedUpdate apply(Map&lt;String, Object&gt; arguments) {
            return Builders.update(DynamoDBEntity.class)                                <i class="conum" data-value="3"></i><b>(3)</b>
                .hash(arguments.get("hashKey"))                                         <i class="conum" data-value="4"></i><b>(4)</b>
                .range(arguments.get("rangeKey"))                                       <i class="conum" data-value="5"></i><b>(5)</b>
                .add("number", 1)                                                       <i class="conum" data-value="6"></i><b>(6)</b>
                .returnUpdatedNew(DynamoDBEntity::getNumber);                           <i class="conum" data-value="7"></i><b>(7)</b>
        }
    }

    @Update(IncrementNumber.class)                                                      <i class="conum" data-value="8"></i><b>(8)</b>
    Number increment(String hashKey, String rangeKey);                                  <i class="conum" data-value="9"></i><b>(9)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedUpdate&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use <code>Builders</code> class to create an update builder for given DynamoDB entity (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify a hash key with <code>hash</code> method and method&#8217;s <code>hashKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify a range key with <code>range</code> method and method&#8217;s <code>rangeKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify update operation - increment <code>number</code> attribute (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference). You may have multiple update operations.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Specify what should be returned from the method (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference).</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td><code>@Update</code> annotation accepts a class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedUpdate&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>The arguments have no special meaning but you can use them in the scan definition. The method&#8217;s return value depends on the value returned from <code>returnUpdatedNew</code> mapper.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dynamodb_service">DynamoDB Service</h4>
<div class="paragraph">
<p><code>DynamoDBService</code> provides middle-level API for working with DynamoDB tables and entites. You can obtain instance of <code>DynamoDBService</code> from
<code>DynamoDBServiceProvider</code> which can be injected to any bean.</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-groovy hljs" data-lang="groovy">DynamoDBServiceProvider provider = context.getBean(DynamoDBServiceProvider)
DynamoDBService&lt;DynamoDBEntity&gt; s = provider.findOrCreate(DynamoDBEntity)       <i class="conum" data-value="1"></i><b>(1)</b>

s.createTable()                                                                 <i class="conum" data-value="2"></i><b>(2)</b>

s.save(new DynamoDBEntity(                                                      <i class="conum" data-value="3"></i><b>(3)</b>
    parentId: '1',
    id: '1',
    rangeIndex: 'foo',
    date: REFERENCE_DATE.toDate()
))

s.get('1', '1')                                                                 <i class="conum" data-value="4"></i><b>(4)</b>

s.query('1', DynamoDBEntity.RANGE_INDEX, 'bar').count == 1                      <i class="conum" data-value="5"></i><b>(5)</b>

s.queryByDates('3', DynamoDBEntity.DATE_INDEX, [                                <i class="conum" data-value="6"></i><b>(6)</b>
    after: REFERENCE_DATE.plusDays(9).toDate(),
    before: REFERENCE_DATE.plusDays(20).toDate(),
]).count == 1

s.increment('1', '1', 'number')                                                 <i class="conum" data-value="7"></i><b>(7)</b>

s.delete(s.get('1', '1'))                                                       <i class="conum" data-value="8"></i><b>(8)</b>

s.deleteAll('1', DynamoDBEntity.RANGE_INDEX, 'bar') == 1                        <i class="conum" data-value="9"></i><b>(9)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtain the instance of <code>DynamoDBService</code> from <code>DynamoDBServiceProvider</code> (provider can be injected)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create table for the entity</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Save an entity</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Load the entity by its hash and range keys</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Query the table for entities with given range index value</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Query the table for entities having date between the specified dates</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Increment a property for entity specified by hash and range keys</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Delete an entity by object reference</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Delete all entities with given range index value</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">DynamoDBServiceProvider provider = ctx.getBean(DynamoDBServiceProvider.class);
DynamoDBService&lt;DynamoDBEntity&gt; s = provider.findOrCreate(DynamoDBEntity.class);<i class="conum" data-value="1"></i><b>(1)</b>

assertNotNull(
    s.createTable(5L, 5L)                                                       <i class="conum" data-value="2"></i><b>(2)</b>
);

assertNotNull(
    s.save(createEntity("1", "1", "foo", REFERENCE_DATE.toDate()))              <i class="conum" data-value="3"></i><b>(3)</b>
);

assertNotNull(
    s.get("1", "1")                                                             <i class="conum" data-value="4"></i><b>(4)</b>
);

assertEquals(1,
    s.query("1", DynamoDBEntity.RANGE_INDEX, "bar").getCount().intValue()        <i class="conum" data-value="5"></i><b>(5)</b>
);

assertEquals(1,
    s.queryByDates(                                                             <i class="conum" data-value="6"></i><b>(6)</b>
        "3",
        DynamoDBEntity.DATE_INDEX,
        REFERENCE_DATE.plusDays(9).toDate(),
        REFERENCE_DATE.plusDays(20).toDate()
    ).getCount().intValue()
);

s.increment("1", "1", "number");                                                <i class="conum" data-value="7"></i><b>(7)</b>

s.delete(s.get("1", "1"));                                                      <i class="conum" data-value="8"></i><b>(8)</b>

assertEquals(1,
    s.deleteAll("1", DynamoDBEntity.RANGE_INDEX, "bar")                         <i class="conum" data-value="9"></i><b>(9)</b>
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtain the instance of <code>DynamoDBService</code> from <code>DynamoDBServiceProvider</code> (provider can be injected)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create table for the entity</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Save an entity</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Load the entity by its hash and range keys</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Query the table for entities with given range index value</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Query the table for entities having date between the specified dates</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Increment a property for entity specified by hash and range keys</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Delete an entity by object reference</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Delete all entities with given range index value</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/DynamoDBService.html">DynamoDBService</a> for full reference.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing">Testing</h4>
<div class="paragraph">
<p>You can very easily mock any of the interfaces and declarative services but if you need close-to-production
DynamoDB integration works well with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a>.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code>compile group: 'org.testcontainers', name: 'localstack', version: '1.10.2'
compile group: 'org.testcontainers', name: 'spock', version: '1.10.2'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;localstack&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;spock&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can setup your tests like this:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Stepwise
@Testcontainers                                                                         <i class="conum" data-value="1"></i><b>(1)</b>
class DefaultDynamoDBServiceSpec extends Specification {
    @AutoCleanup ApplicationContext context                                             <i class="conum" data-value="2"></i><b>(2)</b>

    @Shared LocalStackContainer localstack = new LocalStackContainer()                  <i class="conum" data-value="3"></i><b>(3)</b>
        .withServices(LocalStackContainer.Service.DYNAMODB)

    DynamoDBService&lt;DynamoDBEntity&gt; s
    AmazonDynamoDB amazonDynamoDB
    IDynamoDBMapper mapper

    void setup() {
        amazonDynamoDB = AmazonDynamoDBClient                                           <i class="conum" data-value="4"></i><b>(4)</b>
            .builder()
            .withEndpointConfiguration(
                localstack.getEndpointConfiguration(LocalStackContainer.Service.DYNAMODB)
            )
            .withCredentials(
                localstack.defaultCredentialsProvider
            )
            .build()

        mapper = new DynamoDBMapper(amazonDynamoDB)

        context = ApplicationContext.build().build()
        context.registerSingleton(AmazonDynamoDB, amazonDynamoDB)                       <i class="conum" data-value="5"></i><b>(5)</b>
        context.registerSingleton(IDynamoDBMapper, mapper)                              <i class="conum" data-value="6"></i><b>(6)</b>
        context.start()

        DynamoDBServiceProvider provider = context.getBean(DynamoDBServiceProvider)     <i class="conum" data-value="7"></i><b>(7)</b>
        s = provider.findOrCreate(DynamoDBEntity)                                       <i class="conum" data-value="8"></i><b>(8)</b>
    }

    // test methods

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@Testcontainers</code> to let Spock manage the Testcontainers for you</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code>, <code>@AutoCleanup</code> guarantees closing the context after the tests</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with only DynamoDB support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create <code>AmazonDynamoDB</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Register the client using LocalStack to the application context</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Register the mapper using LocalStack to the application context</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Obtain the provider bean</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Obtain <code>DynamoDBService</code> for particular DynamoDB entity</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class DynamoDBServiceTest {
    @Rule
    public LocalStackContainer localstack = new LocalStackContainer()                   <i class="conum" data-value="1"></i><b>(1)</b>
        .withServices(LocalStackContainer.Service.DYNAMODB);

    public ApplicationContext ctx;                                                      <i class="conum" data-value="2"></i><b>(2)</b>

    @Before
    public void setup() {
        AmazonDynamoDB amazonDynamoDB = AmazonDynamoDBClient                            <i class="conum" data-value="3"></i><b>(3)</b>
            .builder()
            .withEndpointConfiguration(
                localstack.getEndpointConfiguration(LocalStackContainer.Service.DYNAMODB)
            )
            .withCredentials(
                localstack.getDefaultCredentialsProvider()
            )
            .build();

        IDynamoDBMapper mapper = new DynamoDBMapper(amazonDynamoDB);

        ctx = ApplicationContext.build().build();
        ctx.registerSingleton(AmazonDynamoDB.class, amazonDynamoDB);                    <i class="conum" data-value="4"></i><b>(4)</b>
        ctx.registerSingleton(IDynamoDBMapper.class, mapper);                           <i class="conum" data-value="5"></i><b>(5)</b>
        ctx.start();
    }

    @After
    public void cleanup() {
        if (ctx != null) {                                                              <i class="conum" data-value="6"></i><b>(6)</b>
            ctx.close();
        }
    }

    @Test
    public void testSomething() {
        DynamoDBServiceProvider provider = ctx.getBean(DynamoDBServiceProvider.class);  <i class="conum" data-value="7"></i><b>(7)</b>
        DynamoDBService&lt;DynamoDBEntity&gt; s = provider.findOrCreate(DynamoDBEntity.class);<i class="conum" data-value="8"></i><b>(8)</b>

        // test code
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with only DynamoDB support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create <code>AmazonDynamoDB</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Register the client using LocalStack to the application context</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Register the mapper using LocalStack to the application context</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Close the application context after test execution</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Obtain the provider bean</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Obtain <code>DynamoDBService</code> for particular DynamoDB entity</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can obtain instances of declarative client from the context as well.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kinesis">Kinesis</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon Kinesis makes it easy to collect, process, and analyze real-time, streaming data so you can get timely insights and react quickly to new information.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides three approaches to work with Kinesis streams:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>High-level <a href="#_publishing_with_kinesisclient">Publishing with <code>@KinesisClient</code></a></p>
</li>
<li>
<p>High-level <a href="#_listening_with_kinesislistener">Listening with <code>@KinesisListener</code></a></p>
</li>
<li>
<p>Middle-level <a href="#_kinesis_service">Kinesis Service</a></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_configuration">Configuration</h4>
<div class="paragraph">
<p>By default, only <code>aws.kinesis.application.name</code> and <code>aws.kinesis.listener.stream</code> are required if you decide to use <code>@KinesisListener</code>.
Otherwise you need no configuration at all but some of the configuration may be useful for you.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">aws:
  kinesis:
    stream: MyStream                                                                    <i class="conum" data-value="1"></i><b>(1)</b>

    streams:                                                                            <i class="conum" data-value="2"></i><b>(2)</b>
      test:                                                                             <i class="conum" data-value="3"></i><b>(3)</b>
        stream: TestStream

    application:
      name: MyKinesisApp                                                                <i class="conum" data-value="4"></i><b>(4)</b>
    worker:
      id: rubble                                                                        <i class="conum" data-value="5"></i><b>(5)</b>
    listener:
      stream: MyStreamToConsume                                                         <i class="conum" data-value="6"></i><b>(6)</b>

    listeners:                                                                          <i class="conum" data-value="7"></i><b>(7)</b>
      test:                                                                             <i class="conum" data-value="8"></i><b>(8)</b>
        stream: TestStreamToConsume</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can specify the default stream for <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/kinesis/KinesisService.html">KinesisService</a> and <code>@KinesisClient</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can define multiple configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Each of the configuration can be access using <code>@Named('test') KinesisService</code> qualifier or you can define the configuration as <code>value</code> of <code>@KinesisClient('test')</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Application name is required for <code>@KinesisListner</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Optional id of the Kinesis worker (listener)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Stream to listen is required for <code>@KinesisListener</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can define multiple listeners configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The name of the configuration will be used as <code>value</code> of <code>@KinesisListener('test')</code></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_publishing_with_kinesisclient">Publishing with <code>@KinesisClient</code></h4>
<div class="paragraph">
<p>If you place <code>com.agorapulse.micronaut.aws.kinesis.annotation.KinesisClient</code> annotation on the interface then methods
matching predefined pattern will be automatically implemented. Every method of <code>KinesisClient</code> puts new records into
the stream.</p>
</div>
<div class="paragraph">
<p>The following example shows many of available method signatures for publishing records:</p>
</div>
<div class="listingblock">
<div class="title">Publishing String Records</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">@KinesisClient                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {
    void putRecordString(String record);                                                <i class="conum" data-value="2"></i><b>(2)</b>

    PutRecordResult putRecord(String partitionKey, String record);                      <i class="conum" data-value="3"></i><b>(3)</b>

    void putRecordAnno(@PartitionKey String id, String record);                         <i class="conum" data-value="4"></i><b>(4)</b>

    void putRecord(String partitionKey, String record, String sequenceNumber);          <i class="conum" data-value="5"></i><b>(5)</b>

    void putRecordAnno(                                                                 <i class="conum" data-value="6"></i><b>(6)</b>
        @PartitionKey String id,
        String record,
        @SequenceNumber String sqn
    );

    void putRecordAnnoNumbers(                                                          <i class="conum" data-value="7"></i><b>(7)</b>
        @PartitionKey Long id,
        String record,
        @SequenceNumber int sequenceNumber
    );
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisClient</code> annotation makes the interface a Kinesis client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can put String into the stream with generated UUID as partition key</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can user predefined partition key</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If the name of the argument does not contain word <code>parition</code> then <code>@PartitionKey</code> annotation must to be used</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can put String into the stream with predefined partition key and a sequence number</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>If the name of the sequence number argument does not contain word <code>sequence</code> then <code>@SequenceKey</code> annotation must to be used</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The type of parition key and sequence number does not matter as the value will be always converted to string</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Publishing Byte Array Records</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">@KinesisClient                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {
    void putRecordBytes(byte[] record);                                                 <i class="conum" data-value="2"></i><b>(2)</b>

    void putRecordDataByteArray(@PartitionKey String id, byte[] value);                 <i class="conum" data-value="3"></i><b>(3)</b>

    PutRecordsResult putRecords(Iterable&lt;PutRecordsRequestEntry&gt; entries);              <i class="conum" data-value="4"></i><b>(4)</b>

    PutRecordsResult putRecords(PutRecordsRequestEntry... entries);                     <i class="conum" data-value="5"></i><b>(5)</b>

    PutRecordsResult putRecord(PutRecordsRequestEntry entry);                           <i class="conum" data-value="6"></i><b>(6)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisClient</code> annotation makes the interface a Kinesis client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can put byte array into the stream, UUID as partition key will be generated</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If the name of the argument does not contain word <code>parition</code> then <code>@PartitionKey</code> annotation must to be used</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can put several records wrapped into iterable of <code>PutRecordsRequestEntry</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can put several records wrapped into array of <code>PutRecordsRequestEntry</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>If the single argument is of type <code>PutRecordsRequestEntry</code> then <code>PutRecordsResult</code> object is returned from the method despite only single record has been published</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Publishing Plain Old Java Objects</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">@KinesisClient                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {
    void putRecordObject(Pogo pogo);                                                    <i class="conum" data-value="2"></i><b>(2)</b>

    PutRecordsResult putRecordObjects(Pogo... pogo);                                    <i class="conum" data-value="3"></i><b>(3)</b>

    PutRecordsResult putRecordObjects(Iterable&lt;Pogo&gt; pogo);                             <i class="conum" data-value="4"></i><b>(4)</b>

    void putRecordDataObject(@PartitionKey String id, Pogo value);                      <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisClient</code> annotation makes the interface a Kinesis client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can put any object into the stream, UUID as partition key will be generated, the objects will be serialized to JSON</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can put array of any objects into the stream, UUID as partition key will be generated for each record, each object will be serialized to JSON</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can put iterable of any objects into the stream, UUID as partition key will be generated for each record, each object will be serialized to JSON</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can put any object into the stream with predefined partition key, if the name of the argument does not contain word <code>parition</code> then <code>@PartitionKey</code> annotation must to be used</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Publishing Events</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">@KinesisClient                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {
    PutRecordResult putEvent(MyEvent event);                                            <i class="conum" data-value="2"></i><b>(2)</b>

    PutRecordsResult putEventsIterable(Iterable&lt;MyEvent&gt; events);                       <i class="conum" data-value="3"></i><b>(3)</b>

    void putEventsArrayNoReturn(MyEvent... events);                                     <i class="conum" data-value="4"></i><b>(4)</b>

    @Stream("OtherStream") PutRecordResult putEventToStream(MyEvent event);             <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisClient</code> annotation makes the interface a Kinesis client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can put object implementing <code>Event</code> into the stream</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can put iterable of objects implementing <code>Event</code> into the stream</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can put array of objects implementing <code>Event</code> into the stream</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Without any parameters <code>@KinesisClient</code> publishes to default stream of the default configuration but you can change it using <code>@Stream</code> annotation on the method</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The return value of the method is <code>PutRecordResult</code> or <code>PutRecordsResult</code> for putting multiple records but it can be always
omitted and replaced with <code>void</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, <code>KinesisClient</code> publishes records into the default stream defined by <code>aws.kinesis.stream</code> property.
You can switch to different configuration by changing the <code>value</code> of the annotation such as <code>@KinesisClient("other")</code> or
by setting the <code>stream</code> property of the annotation such as <code>@KinesisClient(stream = "MyStream")</code>. You can change stream
used by particular method using <code>@Stream</code> annotation as mentioned above.</p>
</div>
</div>
<div class="sect3">
<h4 id="_listening_with_kinesislistener">Listening with <code>@KinesisListener</code></h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Before you start implementing your service with <code>@KinesisListener</code> you may consider implementing a Lambda function
instead.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you place <code>com.agorapulse.micronaut.aws.kinesis.annotation.KinesisListener</code> annotation on the method in the bean
then the method will be triggered with the new records in the stream.</p>
</div>
<div class="paragraph">
<p>source,java,indent=0,options="nowrap"]
.Publishing Events</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@Singleton                                                                              <i class="conum" data-value="1"></i><b>(1)</b>
public class KinesisListenerTester {

    @KinesisListener
    public void listenString(String string) {                                           <i class="conum" data-value="2"></i><b>(2)</b>
        String message = "EXECUTED: listenString(" + string + ")";
        logExecution(message);
    }

    @KinesisListener
    public void listenRecord(Record record) {                                           <i class="conum" data-value="3"></i><b>(3)</b>
        logExecution("EXECUTED: listenRecord(" + record + ")");
    }


    @KinesisListener
    public void listenStringRecord(String string, Record record) {                      <i class="conum" data-value="4"></i><b>(4)</b>
        logExecution("EXECUTED: listenStringRecord(" + string + ", " + record + ")");
    }

    @KinesisListener
    public void listenObject(MyEvent event) {                                           <i class="conum" data-value="5"></i><b>(5)</b>
        logExecution("EXECUTED: listenObject(" + event + ")");
    }

    @KinesisListener
    public void listenObjectRecord(MyEvent event, Record record) {                      <i class="conum" data-value="6"></i><b>(6)</b>
        logExecution("EXECUTED: listenObjectRecord(" + event + ", " + record + ")");
    }

    @KinesisListener
    public void listenPogoRecord(Pogo event) {                                          <i class="conum" data-value="7"></i><b>(7)</b>
        logExecution("EXECUTED: listenPogoRecord(" + event + ")");
    }

    public List&lt;String&gt; getExecutions() {
        return executions;
    }

    public void setExecutions(List&lt;String&gt; executions) {
        this.executions = executions;
    }

    private void logExecution(String message) {
        executions.add(message);
        System.err.println(message);
    }

    private List&lt;String&gt; executions = new CopyOnWriteArrayList&lt;&gt;();
}</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisListener</code> method must be declared in a bean, e.g. <code>@Singleton</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can listen to just plain string records</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can listen to <code>Record</code> objects</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can listen to both string and <code>Record</code> objects</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can listen to objects implementing <code>Event</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can listen to both <code>Event</code> and <code>Record</code> objects</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can listen to any object as long as it can be unmarshalled from the record payload</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can listen to different than default configuration by changing the <code>value</code> of the annotation such as <code>@KinesisListener("other")</code>.</p>
</div>
<div class="paragraph">
<p>Multiple methods in a single application can listen to the same configuration (stream). In that case, every method will be executed with the
incoming payload.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kinesis_service">Kinesis Service</h4>
<div class="paragraph">
<p><code>KinesisService</code> provides middle-level API for creating, describing, and deleting streams. You can manage shards as well as read records
from particular shards.</p>
</div>
<div class="paragraph">
<p>Instance of <code>KinesisService</code> is created for the default Kinesis configuration and each stream configuration in <code>aws.kinesis.streams</code> map.
You should always use <code>@Named</code> qualifier when injecting <code>KinesisService</code> if you have more than one stream configuration present, e.g. <code>@Named("other") KinesisService otherService</code>.</p>
</div>
<div class="paragraph">
<p>Please, see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/kinesis/KinesisService.html">KinesisService</a> for the full reference.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_2">Testing</h4>
<div class="paragraph">
<p>You can very easily mock any of the interfaces and declarative services but if you need close-to-production
Kinesis integration works well with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a>.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code>compile group: 'org.testcontainers', name: 'localstack', version: '1.10.2'
compile group: 'org.testcontainers', name: 'spock', version: '1.10.2'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;localstack&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;spock&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can setup your tests like this:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Testcontainers                                                                         <i class="conum" data-value="1"></i><b>(1)</b>
@RestoreSystemProperties                                                                <i class="conum" data-value="2"></i><b>(2)</b>
class KinesisAnnotationsSpec extends Specification {

    private static final String TEST_STREAM = 'TestStream'
    private static final String APP_NAME = 'AppName'

    @Shared LocalStackContainer localstack = new LocalStackContainer('0.8.8')   <i class="conum" data-value="3"></i><b>(3)</b>
        .withServices(KINESIS, DYNAMODB)

    @AutoCleanup ApplicationContext context                                             <i class="conum" data-value="4"></i><b>(4)</b>

    void setup() {
        System.setProperty('com.amazonaws.sdk.disableCbor', 'true')                     <i class="conum" data-value="5"></i><b>(5)</b>

        AmazonDynamoDB dynamo = AmazonDynamoDBClient                                    <i class="conum" data-value="6"></i><b>(6)</b>
            .builder()
            .withEndpointConfiguration(localstack.getEndpointConfiguration(DYNAMODB))
            .withCredentials(localstack.defaultCredentialsProvider)
            .build()

        AmazonKinesis kinesis = AmazonKinesisClient                                     <i class="conum" data-value="7"></i><b>(7)</b>
            .builder()
            .withEndpointConfiguration(localstack.getEndpointConfiguration(KINESIS))
            .withCredentials(localstack.defaultCredentialsProvider)
            .build()

        AmazonCloudWatch amazonCloudWatch = Mock(AmazonCloudWatch)

        context = ApplicationContext.build().properties(                                <i class="conum" data-value="8"></i><b>(8)</b>
            'aws.kinesis.application.name': APP_NAME,
            'aws.kinesis.stream': TEST_STREAM,
            'aws.kinesis.listener.stream': TEST_STREAM,
            'aws.kinesis.listener.failoverTimeMillis': '1000',
            'aws.kinesis.listener.shardSyncIntervalMillis': '1000',
            'aws.kinesis.listener.idleTimeBetweenReadsInMillis': '1000',
            'aws.kinesis.listener.parentShardPollIntervalMillis': '1000',
            'aws.kinesis.listener.timeoutInSeconds': '1000',
            'aws.kinesis.listener.retryGetRecordsInSeconds': '1000',
            'aws.kinesis.listener.metricsLevel': 'NONE',
        ).build()
        context.registerSingleton(AmazonKinesis, kinesis)
        context.registerSingleton(AmazonDynamoDB, dynamo)
        context.registerSingleton(AmazonCloudWatch, amazonCloudWatch)
        context.registerSingleton(AWSCredentialsProvider, localstack.defaultCredentialsProvider)
        context.start()
    }

    void 'kinesis listener is executed'() {
        when:
            KinesisService service = context.getBean(KinesisService)                    <i class="conum" data-value="9"></i><b>(9)</b>
            KinesisListenerTester tester = context.getBean(KinesisListenerTester)       <i class="conum" data-value="10"></i><b>(10)</b>
            DefaultClient client = context.getBean(DefaultClient)                       <i class="conum" data-value="11"></i><b>(11)</b>

            service.createStream()
            service.waitForActive()

            waitForWorkerReady(300, 100)

            Disposable subscription = publishEventAsync(tester, client)

            waitForReceivedMessages(tester, 300, 100)

            subscription.dispose()
        then:
            allTestEventsReceived(tester)
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@Testcontainers</code> to let Spock manage the Testcontainers for you</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@RestoreSystemProperties</code> will guarantee that system properties will be restore after the test</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with Kinesis and  DynamoDB (required by the listener) support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code>, <code>@AutoCleanup</code> guarantees closing the context after the tests</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Disable CBOR protocol for Kinesis (not supported by LocalStack/Kinesilite)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Create <code>AmazonDynamoDB</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Create <code>AmazonKinesis</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Prepare the application context with required properties and service LocalStack</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>You can obtain instance of <code>KinesisService</code> from the context</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>You can obtain instance of declarative listener from the context</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>You can obtain instance of declarative client from the context</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class KinesisTest {

    public ApplicationContext context;                                                  <i class="conum" data-value="1"></i><b>(1)</b>

    @Rule
    public LocalStackContainer localstack = new LocalStackContainer("0.8.8")            <i class="conum" data-value="2"></i><b>(2)</b>
        .withServices(DYNAMODB, KINESIS);

    @Before
    public void setup() {
        System.setProperty("com.amazonaws.sdk.disableCbor", "true");                    <i class="conum" data-value="3"></i><b>(3)</b>

        AmazonDynamoDB amazonDynamoDB = AmazonDynamoDBClient                            <i class="conum" data-value="4"></i><b>(4)</b>
            .builder()
            .withEndpointConfiguration(localstack.getEndpointConfiguration(DYNAMODB))
            .withCredentials(localstack.getDefaultCredentialsProvider())
            .build();

        AmazonKinesis amazonKinesis = AmazonKinesisClient                               <i class="conum" data-value="5"></i><b>(5)</b>
            .builder()
            .withEndpointConfiguration(localstack.getEndpointConfiguration(KINESIS))
            .withCredentials(localstack.getDefaultCredentialsProvider())
            .build();

        AmazonCloudWatch cloudWatch = new MockCloudWatch();

        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();                               <i class="conum" data-value="6"></i><b>(6)</b>
        properties.put("aws.kinesis.application.name", "TestApp");
        properties.put("aws.kinesis.stream", TEST_STREAM);
        properties.put("aws.kinesis.listener.stream", TEST_STREAM);

        // you can set other custom client configuration properties
        properties.put("aws.kinesis.listener.failoverTimeMillis", "1000");
        properties.put("aws.kinesis.listener.shardSyncIntervalMillis", "1000");
        properties.put("aws.kinesis.listener.idleTimeBetweenReadsInMillis", "1000");
        properties.put("aws.kinesis.listener.parentShardPollIntervalMillis", "1000");
        properties.put("aws.kinesis.listener.timeoutInSeconds", "1000");
        properties.put("aws.kinesis.listener.retryGetRecordsInSeconds", "1000");
        properties.put("aws.kinesis.listener.metricsLevel", "NONE");


        context = ApplicationContext.build(properties).build();                         <i class="conum" data-value="7"></i><b>(7)</b>
        context.registerSingleton(AmazonKinesis.class, amazonKinesis);
        context.registerSingleton(AmazonDynamoDB.class, amazonDynamoDB);
        context.registerSingleton(AmazonCloudWatch.class, cloudWatch);
        context.registerSingleton(AWSCredentialsProvider.class, localstack.getDefaultCredentialsProvider());
        context.start();
    }

    @After
    public void cleanup() {
        System.clearProperty("com.amazonaws.sdk.disableCbor");                          <i class="conum" data-value="8"></i><b>(8)</b>
        if (context != null) {
            context.close();                                                            <i class="conum" data-value="9"></i><b>(9)</b>
        }
    }

    @Test
    public void testJavaService() throws InterruptedException {
        KinesisService service = context.getBean(KinesisService.class);                 <i class="conum" data-value="10"></i><b>(10)</b>
        KinesisListenerTester tester = context.getBean(KinesisListenerTester.class);    <i class="conum" data-value="11"></i><b>(11)</b>
        DefaultClient client = context.getBean(DefaultClient.class);                    <i class="conum" data-value="12"></i><b>(12)</b>

        service.createStream();
        service.waitForActive();

        waitForWorkerReady(300, 100);
        Disposable subscription = publishEventsAsync(tester, client);
        waitForRecievedMessages(tester, 300, 100);

        subscription.dispose();

        Assert.assertTrue(allTestEventsReceived(tester));
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with Kinesis and  DynamoDB (required by the listener) support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Disable CBOR protocol for Kinesis (not supported by LocalStack/Kinesilite)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create <code>AmazonDynamoDB</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Create <code>AmazonKinesis</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Prepare required properties</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Prepare the application context with required properties and service LocalStack</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Reset CBOR protocol settings after the test</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Close the application context after the test</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>You can obtain instance of <code>KinesisService</code> from the context</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>You can obtain instance of declarative listener from the context</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>You can obtain instance of declarative client from the context</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_simple_storage_service_s3">Simple Storage Service (S3)</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon Simple Storage Service (Amazon S3) is an object storage service that offers industry-leading scalability, data availability, security, and performance.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides basic support for Amazon S3 using <a href="#_simple_storage_service">Simple Storage Service</a></p>
</div>
<div class="sect3">
<h4 id="_configuration_2">Configuration</h4>
<div class="paragraph">
<p>You can store the name of the bucket in the configuration using <code>aws.s3.bucket</code> property. You can create additional configurations
by providing 'aws.s3.buckets' configuration map.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">aws:
  s3:
    bucket: MyBucket                                                                    <i class="conum" data-value="1"></i><b>(1)</b>

    buckets:                                                                            <i class="conum" data-value="2"></i><b>(2)</b>
      test:                                                                             <i class="conum" data-value="3"></i><b>(3)</b>
        bucket: TestBucket</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can define default bucket for the service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can define multiple configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Each of the configuration can be access using <code>@Named('test') SimpleStorageService</code> qualifier</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_simple_storage_service">Simple Storage Service</h4>
<div class="paragraph">
<p><code>SimpleStorageService</code> provides middle-level API for managing buckets and uploading and downloading files.</p>
</div>
<div class="paragraph">
<p>Instance of <code>SimpleStorageService</code> is created for the default S3 configuration and each bucket configuration in <code>aws.s3.buckets</code> map.
You should always use <code>@Named</code> qualifier when injecting <code>SimpleStorageService</code> if you have more than one bucket configuration present, e.g. <code>@Named("test") SimpleStorageService service</code>.</p>
</div>
<div class="paragraph">
<p>Following example shows some of the most common use cases for working with S3 buckets.</p>
</div>
<div class="listingblock">
<div class="title">Creating Bucket</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">service.createBucket(MY_BUCKET);                                                <i class="conum" data-value="1"></i><b>(1)</b>

assertTrue(service.listBucketNames().contains(MY_BUCKET));                      <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new bucket of given name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The bucket is present within the list of all bucket names</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Upload File</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">File sampleContent = createFileWithSampleContent();

service.storeFile(TEXT_FILE_PATH, sampleContent);                               <i class="conum" data-value="1"></i><b>(1)</b>

assertTrue(service.exists(TEXT_FILE_PATH));                                     <i class="conum" data-value="2"></i><b>(2)</b>

Flowable&lt;S3ObjectSummary&gt; summaries = service.listObjectSummaries("foo");       <i class="conum" data-value="3"></i><b>(3)</b>
assertEquals(Long.valueOf(0L), summaries.count().blockingGet());</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Upload file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>File is uploaded</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>File is present in the summaries of all files</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Upload from <code>InputStream</code></div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">service.storeInputStream(                                                       <i class="conum" data-value="1"></i><b>(1)</b>
    KEY,
    new ByteArrayInputStream(SAMPLE_CONTENT.getBytes()),
    buildMetadata()
);

Flowable&lt;S3ObjectSummary&gt; fooSummaries = service.listObjectSummaries("foo");    <i class="conum" data-value="2"></i><b>(2)</b>
assertEquals(KEY, fooSummaries.blockingFirst().getKey());</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Upload data from stream</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Stream is uploaded</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Generate URL</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">String url = service.generatePresignedUrl(KEY, TOMORROW);                       <i class="conum" data-value="1"></i><b>(1)</b>

assertEquals(SAMPLE_CONTENT, download(url));                                    <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Generate presigned URL</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Downloaded content corresponds with the expected content</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Download File</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">File dir = tmp.newFolder();
File file = new File(dir, "bar.baz");                                           <i class="conum" data-value="1"></i><b>(1)</b>

service.getFile(KEY, file);                                                     <i class="conum" data-value="2"></i><b>(2)</b>
assertTrue(file.exists());

assertEquals(SAMPLE_CONTENT, new String(Files.readAllBytes(Paths.get(file.toURI()))));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prepare a destination file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Download the file locally</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Delete File</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">service.deleteFile(TEXT_FILE_PATH);                                             <i class="conum" data-value="1"></i><b>(1)</b>
assertFalse(service.exists(TEXT_FILE_PATH));                                    <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Delete file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The file is no longer present</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Delete Bucket</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">service.deleteBucket();                                                         <i class="conum" data-value="1"></i><b>(1)</b>
assertFalse(service.listBucketNames().contains(MY_BUCKET));                     <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Delete bucket</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The Bucket is no longer present</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please, see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/s3/SimpleStorageService.html">SimpleStorageService</a> for the full reference.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_3">Testing</h4>
<div class="paragraph">
<p>You can very easily mock the <code>SimpleStorageService</code> but if you need close-to-production
S3 integration works well with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a>.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code>compile group: 'org.testcontainers', name: 'localstack', version: '1.10.2'
compile group: 'org.testcontainers', name: 'spock', version: '1.10.2'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;localstack&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;spock&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can setup your tests like this:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Stepwise
@Testcontainers                                                                         <i class="conum" data-value="1"></i><b>(1)</b>
class SimpleStorageServiceSpec extends Specification {

    @AutoCleanup ApplicationContext context                                             <i class="conum" data-value="2"></i><b>(2)</b>

    @Shared LocalStackContainer localstack = new LocalStackContainer()                  <i class="conum" data-value="3"></i><b>(3)</b>
        .withServices(S3)

    @Rule TemporaryFolder tmp

    AmazonS3 amazonS3
    SimpleStorageService service

    void setup() {
        amazonS3 = AmazonS3Client                                                       <i class="conum" data-value="4"></i><b>(4)</b>
            .builder()
            .withEndpointConfiguration(localstack.getEndpointConfiguration(S3))
            .withCredentials(localstack.defaultCredentialsProvider)
            .build()

        context = ApplicationContext
            .build('aws.s3.bucket': MY_BUCKET)                                          <i class="conum" data-value="5"></i><b>(5)</b>
            .build()
        context.registerSingleton(AmazonS3, amazonS3)                                   <i class="conum" data-value="6"></i><b>(6)</b>
        context.start()

        service = context.getBean(SimpleStorageService)                                 <i class="conum" data-value="7"></i><b>(7)</b>
    }

    // test methods

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@Testcontainers</code> to let Spock manage the Testcontainers for you</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code>, <code>@AutoCleanup</code> guarantees closing the context after the tests</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with S3 support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create <code>AmazonS3</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Set the default bucket</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Register <code>AmazonS3</code> service running against LocalStack</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can obtain instance of <code>SimpleStorageService</code> from the context</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SimpleStorageServiceTest {

    @Rule
    public final LocalStackContainer localstack = new LocalStackContainer()            <i class="conum" data-value="1"></i><b>(1)</b>
        .withServices(S3);

    @Rule
    public final TemporaryFolder tmp = new TemporaryFolder();

    private ApplicationContext ctx;                                                     <i class="conum" data-value="2"></i><b>(2)</b>

    @Before
    public void setup() {
        AmazonS3 amazonS3 = AmazonS3Client                                              <i class="conum" data-value="3"></i><b>(3)</b>
            .builder()
            .withEndpointConfiguration(localstack.getEndpointConfiguration(S3))
            .withCredentials(localstack.getDefaultCredentialsProvider())
            .build();

        ctx = ApplicationContext
            .build(Collections.singletonMap("aws.s3.bucket", MY_BUCKET))
            .build();
        ctx.registerSingleton(AmazonS3.class, amazonS3);                                <i class="conum" data-value="4"></i><b>(4)</b>
        ctx.start();
    }

    @After
    public void cleanup() {
        if (ctx != null) {                                                              <i class="conum" data-value="5"></i><b>(5)</b>
            ctx.close();
        }
    }

    // test methods

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with Kinesis and  DynamoDB (required by the listener) support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create <code>AmazonS3</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Register <code>AmazonS3</code> service running against LocalStack</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Don&#8217;t forget to close <code>ApplicationContext</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_simple_email_service_ses">Simple Email Service (SES)</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon Simple Email Service (Amazon SES) is a cloud-based email sending service designed to help digital marketers and application developers send marketing, notification, and transactional emails. It is a reliable, cost-effective service for businesses of all sizes that use email to keep in contact with their customers.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides basic support for Amazon SES using <a href="#_simple_email_service">Simple Email Service</a></p>
</div>
<div class="sect3">
<h4 id="_simple_email_service">Simple Email Service</h4>
<div class="paragraph">
<p><code>SimpleEmailService</code> provides DSL for creating and sending simple emails with attachments. As the other services,
it uses default credentials chain to obtain the credentials.</p>
</div>
<div class="paragraph">
<p>Following example shows how to send an email with attachment.</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-groovy hljs" data-lang="groovy">package com.agorapulse.micronaut.aws.ses

import com.amazonaws.services.simpleemail.AmazonSimpleEmailService
import com.amazonaws.services.simpleemail.model.SendRawEmailRequest
import com.amazonaws.services.simpleemail.model.SendRawEmailResult
import org.junit.Rule
import org.junit.rules.TemporaryFolder
import spock.lang.Specification
import spock.lang.Subject

/**
 * Tests for sending emails with Groovy.
 */
class SendEmailSpec extends Specification {

    AmazonSimpleEmailService simpleEmailService = Mock(AmazonSimpleEmailService)

    @Rule
    TemporaryFolder tmp = new TemporaryFolder()

    @Subject
    SimpleEmailService service = new DefaultSimpleEmailService(simpleEmailService)

    void "send email"() {
        given:
            File file = tmp.newFile('test.pdf')
            file.text = 'not a real PDF'
            String thePath = file.canonicalPath
        when:
            EmailDeliveryStatus status = service.send {                                 <i class="conum" data-value="1"></i><b>(1)</b>
                subject 'Hi Paul'                                                       <i class="conum" data-value="2"></i><b>(2)</b>
                from 'subscribe@groovycalamari.com'                                     <i class="conum" data-value="3"></i><b>(3)</b>
                to 'me@sergiodelamo.com'                                                <i class="conum" data-value="4"></i><b>(4)</b>
                htmlBody '&lt;p&gt;This is an example body&lt;/p&gt;'                               <i class="conum" data-value="5"></i><b>(5)</b>
                attachment {                                                            <i class="conum" data-value="6"></i><b>(6)</b>
                    filepath thePath                                                    <i class="conum" data-value="7"></i><b>(7)</b>
                    filename 'test.pdf'                                                 <i class="conum" data-value="8"></i><b>(8)</b>
                    mimeType 'application/pdf'                                          <i class="conum" data-value="9"></i><b>(9)</b>
                    description 'An example pdf'                                        <i class="conum" data-value="10"></i><b>(10)</b>
                }
            }

        then:
            status == EmailDeliveryStatus.STATUS_DELIVERED

            simpleEmailService.sendRawEmail(_) &gt;&gt; { SendRawEmailRequest request -&gt;
                return new SendRawEmailResult().withMessageId('foobar')
            }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start building an email</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define subject of the email</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the from address</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define one or more recipients</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Define HTML body (alternatively you can declare plain text body as well)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Build an attachment</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Define the location of the file to be sent</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Define the file name (optional - deduced from the file)</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Define the mime type (usually optional - deduced from the file)</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Define the description of the file (optional)</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">package com.agorapulse.micronaut.aws.ses;

import com.amazonaws.services.simpleemail.AmazonSimpleEmailService;
import com.amazonaws.services.simpleemail.model.SendRawEmailResult;
import org.junit.Assert;
import org.junit.Rule;
import org.junit.Test;
import org.junit.rules.TemporaryFolder;
import org.mockito.Mockito;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.util.Collections;

import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

/**
 * Tests for sending emails with Java.
 */
public class SendEmailTest {

    @Rule public TemporaryFolder tmp = new TemporaryFolder();

    private AmazonSimpleEmailService simpleEmailService = mock(AmazonSimpleEmailService.class);

    private SimpleEmailService service = new DefaultSimpleEmailService(simpleEmailService);

    @Test
    public void testSendEmail() throws IOException {
        when(simpleEmailService.sendRawEmail(Mockito.any()))
            .thenReturn(new SendRawEmailResult().withMessageId("foobar"));

        File file = tmp.newFile("test.pdf");
        Files.write(file.toPath(), Collections.singletonList("not a real PDF"));
        String filepath = file.getCanonicalPath();

        EmailDeliveryStatus status = service.send(e -&gt;                                  <i class="conum" data-value="1"></i><b>(1)</b>
            e.subject("Hi Paul")                                                        <i class="conum" data-value="2"></i><b>(2)</b>
                .from("subscribe@groovycalamari.com")                                   <i class="conum" data-value="3"></i><b>(3)</b>
                .to("me@sergiodelamo.com")                                              <i class="conum" data-value="4"></i><b>(4)</b>
                .htmlBody("&lt;p&gt;This is an example body&lt;/p&gt;")                             <i class="conum" data-value="5"></i><b>(5)</b>
                .attachment(a -&gt;                                                        <i class="conum" data-value="6"></i><b>(6)</b>
                    a.filepath(filepath)                                                <i class="conum" data-value="7"></i><b>(7)</b>
                        .filename("test.pdf")                                           <i class="conum" data-value="8"></i><b>(8)</b>
                        .mimeType("application/pdf")                                    <i class="conum" data-value="9"></i><b>(9)</b>
                        .description("An example pdf")                                  <i class="conum" data-value="10"></i><b>(10)</b>
                )
        );

        Assert.assertEquals(EmailDeliveryStatus.STATUS_DELIVERED, status);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start building an email</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define subject of the email</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the from address</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define one or more recipients</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Define HTML body (alternatively you can declare plain text body as well)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Build an attachment</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Define the location of the file to be sent</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Define the file name (optional - deduced from the file)</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Define the mime type (usually optional - deduced from the file)</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Define the description of the file (optional)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please, see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/ses/SimpleEmailService.html">SimpleEmailService</a> for the full reference.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_4">Testing</h4>
<div class="paragraph">
<p>It is recommended just to mock the <code>SimpleEmailService</code> in your tests as it only contains single abstract method.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_simple_notification_service_sns">Simple Notification Service (SNS)</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon Simple Notification Service (SNS) is a highly available, durable, secure, fully managed pub/sub messaging service that enables you to decouple microservices, distributed systems, and serverless applications.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides two approaches to work with Simple Notification Service topics:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>High-level <a href="#_publishing_with_notificationclient">Publishing with <code>@NotificationClient</code></a></p>
</li>
<li>
<p>Middle-level <a href="#_simple_notification_service">Simple Notification Service</a></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_configuration_3">Configuration</h4>
<div class="paragraph">
<p>No configuration is required but some of the configuration properties may be useful for you.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">aws:
  sqs:

    # related to service behaviour
    queueNamePrefix: 'vlad_'                                                            <i class="conum" data-value="1"></i><b>(1)</b>
    autoCreateQueue: false                                                              <i class="conum" data-value="2"></i><b>(2)</b>
    cache: false                                                                        <i class="conum" data-value="3"></i><b>(3)</b>

    # related to default queue
    queue: MyQueue                                                                      <i class="conum" data-value="4"></i><b>(4)</b>
    fifo: true                                                                          <i class="conum" data-value="5"></i><b>(5)</b>
    delaySeconds: 0                                                                     <i class="conum" data-value="6"></i><b>(6)</b>
    messageRetentionPeriod: 345600                                                      <i class="conum" data-value="7"></i><b>(7)</b>
    maximumMessageSize: 262144                                                          <i class="conum" data-value="8"></i><b>(8)</b>
    visibilityTimeout: 30                                                               <i class="conum" data-value="9"></i><b>(9)</b>

    queues:                                                                             <i class="conum" data-value="10"></i><b>(10)</b>
      test:                                                                             <i class="conum" data-value="11"></i><b>(11)</b>
        queue: TestQueue</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can specify the default topic for <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/sns/SimpleNotificationService.html">SimpleNotificationService</a> and <code>@NotificationClient</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Amazon Resource Name for the iOS application mobile push</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Amazon Resource Name for the Android application mobile push</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Amazon Resource Name for the Amazon application mobile push</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can define multiple configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Each of the configuration can be access using <code>@Named('test') SimpleNotificationService</code> qualifier or you can define the configuration as <code>value</code> of <code>@NotificationClient('test')</code></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_publishing_with_notificationclient">Publishing with <code>@NotificationClient</code></h4>
<div class="paragraph">
<p>If you place <code>com.agorapulse.micronaut.aws.sns.annotation.NotificationClient</code> annotation on the interface then methods
matching predefined pattern will be automatically implemented. Methods containing word <code>sms</code> will send text messages.
Other methods of <code>NotificationClient</code> will publish new messages into the topic.</p>
</div>
<div class="paragraph">
<p>The following example shows many of available method signatures for publishing records:</p>
</div>
<div class="listingblock">
<div class="title">Publishing String Records</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">package com.agorapulse.micronaut.aws.sns;

import com.agorapulse.micronaut.aws.Pogo;
import com.agorapulse.micronaut.aws.sns.annotation.NotificationClient;
import com.agorapulse.micronaut.aws.sns.annotation.Topic;

import java.util.Map;

@NotificationClient                                                                     <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {

    String OTHER_TOPIC = "OtherTopic";

    @Topic("OtherTopic") String publishMessageToDifferentTopic(Pogo pogo);              <i class="conum" data-value="2"></i><b>(2)</b>

    String publishMessage(Pogo message);                                                <i class="conum" data-value="3"></i><b>(3)</b>
    String publishMessage(String subject, Pogo message);                                <i class="conum" data-value="4"></i><b>(4)</b>
    String publishMessage(String message);                                              <i class="conum" data-value="5"></i><b>(5)</b>
    String publishMessage(String subject, String message);

    String sendSMS(String phoneNumber, String message);                                 <i class="conum" data-value="6"></i><b>(6)</b>
    String sendSms(String phoneNumber, String message, Map attributes);                 <i class="conum" data-value="7"></i><b>(7)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@NotificationClient</code> annotation makes the interface a SNS client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can specify to which topic is the message published using <code>@Topic</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can publish any object which can be converted into JSON.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can add additional subject to published message (only useful for few protocols, e.g. email)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can publish a string message</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can send SMS using the word <code>SMS</code> in the name of the method. One argument must be phone number and its name must contain the word <code>number</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can provide additional attributes for the SMS message</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The return value of the methods is message id returned by AWS.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, <code>NotificationClient</code> publishes messages into the default topic defined by <code>aws.sns.topic</code> property.
You can switch to different configuration by changing the <code>value</code> of the annotation such as <code>@NotificationClient("other")</code> or
by setting the <code>topic</code> property of the annotation such as <code>@NotificationClient(topic = "SomeTopic")</code>. You can change topic
used by particular method using <code>@Topic</code> annotation as mentioned above.</p>
</div>
</div>
<div class="sect3">
<h4 id="_simple_notification_service">Simple Notification Service</h4>
<div class="paragraph">
<p><code>SimpleNotificationService</code> provides middle-level API for creating, describing, and deleting topics. You can manage applications, endpoints and devices.
You can send messages and notifications.</p>
</div>
<div class="paragraph">
<p>Instance of <code>SimpleNotificationService</code> is created for the default SNS configuration and each topics configuration in <code>aws.sns.topics</code> map.
You should always use <code>@Named</code> qualifier when injecting <code>SimpleNotificationService</code> if you have more than one topic configuration present, e.g. <code>@Named("other") SimpleNotificationService otherService</code>.</p>
</div>
<div class="paragraph">
<p>Following example shows some of the most common use cases for working with Amazon SNS.</p>
</div>
<div class="sect4">
<h5 id="_working_with_topics">Working with Topics</h5>
<div class="listingblock">
<div class="title">Creating Topic</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">String topicArn = service.createTopic(TEST_TOPIC);                              <i class="conum" data-value="1"></i><b>(1)</b>

Topic found = service.listTopics().filter(t -&gt;                                  <i class="conum" data-value="2"></i><b>(2)</b>
    t.getTopicArn().endsWith(TEST_TOPIC)
).blockingFirst();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new topic of given name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The topic is present within the list of all topics' names</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Subscribe to Topic</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">String subArn = service.subscribeTopicWithEmail(topicArn, EMAIL);               <i class="conum" data-value="1"></i><b>(1)</b>

String messageId = service.publishMessageToTopic(                               <i class="conum" data-value="2"></i><b>(2)</b>
    topicArn,
    "Test Email",
    "Hello World"
);

service.unsubscribeTopic(subArn);                                               <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Subscribe to the topic with an email (there are more variants of this method to subscribe to most common protocols such as HTTP(S) endpoints, SQS, &#8230;&#8203;)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Publish message to the topic</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use the subscription ARN to unsubscribe from the topic</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Delete Topic</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">service.deleteTopic(topicArn);                                                  <i class="conum" data-value="1"></i><b>(1)</b>

Long zero = service.listTopics().filter(t -&gt;                                    <i class="conum" data-value="2"></i><b>(2)</b>
    t.getTopicArn().endsWith(TEST_TOPIC)
).count().blockingGet();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Delete the topic</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The topic is no longer present within the list of all topics' names</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_working_with_applications">Working with Applications</h5>
<div class="listingblock">
<div class="title">Working with Applications</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">String appArn = service.createAndroidApplication("my-app", API_KEY);        <i class="conum" data-value="1"></i><b>(1)</b>

String endpoint = service.registerAndroidDevice(appArn, DEVICE_TOKEN, DATA);    <i class="conum" data-value="2"></i><b>(2)</b>

Map&lt;String, String&gt; notif = new LinkedHashMap&lt;&gt;();
notif.put("badge", "9");
notif.put("data", "{\"foo\": \"some bar\"}");
notif.put("title", "Some Title");

String msgId = service.sendAndroidAppNotification(endpoint, notif, "Welcome");  <i class="conum" data-value="3"></i><b>(3)</b>

service.validateAndroidDevice(appArn, endpoint, DEVICE_TOKEN, DATA);            <i class="conum" data-value="4"></i><b>(4)</b>

service.unregisterDevice(endpoint);                                             <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new Android application (more platforms available)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register Android device (more platforms available)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Send Android notification (more platforms available)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Validate Android device</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Unregister device</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_sending_sms">Sending SMS</h5>
<div class="listingblock">
<div class="title">Sending SMS</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">Map&lt;Object, Object&gt; attrs = Collections.emptyMap();
String msgId = service.sendSMSMessage(PHONE_NUMBER, "Hello World", attrs);      <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Send a message to the phone number</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please, see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/sns/SimpleNotificationService.html">SimpleNotificationService</a> for the full reference.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_5">Testing</h4>
<div class="paragraph">
<p>You can very easily mock any of the interfaces and declarative services but if you need close-to-production
SNS integration works well with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a>.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code>compile group: 'org.testcontainers', name: 'localstack', version: '1.10.2'
compile group: 'org.testcontainers', name: 'spock', version: '1.10.2'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;localstack&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;spock&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can setup your tests like this:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Testcontainers                                                                         <i class="conum" data-value="1"></i><b>(1)</b>
class SimpleNotificationServiceSpec extends Specification {

    @Shared LocalStackContainer localstack = new LocalStackContainer('0.8.8')           <i class="conum" data-value="2"></i><b>(2)</b>
        .withServices(SNS)

    @AutoCleanup ApplicationContext context                                             <i class="conum" data-value="3"></i><b>(3)</b>

    SimpleNotificationService service

    void setup() {
        AmazonSNS sns = AmazonSNSClient                                                 <i class="conum" data-value="4"></i><b>(4)</b>
            .builder()
            .withEndpointConfiguration(localstack.getEndpointConfiguration(SNS))
            .withCredentials(localstack.defaultCredentialsProvider)
            .build()

        context = ApplicationContext.build('aws.sns.topic', TEST_TOPIC).build()         <i class="conum" data-value="5"></i><b>(5)</b>
        context.registerSingleton(AmazonSNS, sns)
        context.start()

        service = context.getBean(SimpleNotificationService)                            <i class="conum" data-value="6"></i><b>(6)</b>
    }

    // tests

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@Testcontainers</code> to let Spock manage the Testcontainers for you</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with SNS support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code>, <code>@AutoCleanup</code> guarantees closing the context after the tests</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create <code>AmazonSNS</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Prepare the application context with required properties and service using LocalStack</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can obtain instance of <code>SimpleNotificationService</code> from the context</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class SimpleNotificationServiceTest {

    public ApplicationContext context;                                                  <i class="conum" data-value="1"></i><b>(1)</b>

    public SimpleNotificationService service;

    @Rule
    public LocalStackContainer localstack = new LocalStackContainer("0.8.8")            <i class="conum" data-value="2"></i><b>(2)</b>
        .withServices(SNS);

    @Before
    public void setup() {
        AmazonSNS amazonSNS = AmazonSNSClient                                           <i class="conum" data-value="3"></i><b>(3)</b>
            .builder()
            .withEndpointConfiguration(localstack.getEndpointConfiguration(SNS))
            .withCredentials(localstack.getDefaultCredentialsProvider())
            .build();


        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();                               <i class="conum" data-value="4"></i><b>(4)</b>
        properties.put("aws.sns.topic", TEST_TOPIC);


        context = ApplicationContext.build(properties).build();                         <i class="conum" data-value="5"></i><b>(5)</b>
        context.registerSingleton(AmazonSNS.class, amazonSNS);
        context.start();

        service = context.getBean(SimpleNotificationService.class);
    }

    @After
    public void cleanup() {
        if (context != null) {
            context.close();                                                            <i class="conum" data-value="6"></i><b>(6)</b>
        }
    }

    // tests

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with SNS support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create <code>AmazonSNS</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Prepare required properties</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Prepare the application context with required properties and service LocalStack</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Close the application context after the test</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_simple_queue_service_sqs">Simple Queue Service (SQS)</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon Simple Queue Service (SQS) is a fully managed message queuing service that enables you to decouple and scale microservices, distributed systems, and serverless applications. SQS eliminates the complexity and overhead associated with managing and operating message oriented middleware, and empowers developers to focus on differentiating work.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides two approaches to work with Simple Queue Service queues:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>High-level <a href="#_publishing_with_queueclient">Publishing with <code>@QueueClient</code></a></p>
</li>
<li>
<p>Middle-level <a href="#_simple_queue_service">Simple Queue Service</a></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_configuration_4">Configuration</h4>
<div class="paragraph">
<p>No configuration is required but some of the configuration properties may be useful for you.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">aws:
  sqs:

    # related to service behaviour
    queueNamePrefix: 'vlad_'                                                            <i class="conum" data-value="1"></i><b>(1)</b>
    autoCreateQueue: false                                                              <i class="conum" data-value="2"></i><b>(2)</b>
    cache: false                                                                        <i class="conum" data-value="3"></i><b>(3)</b>

    # related to default queue
    queue: MyQueue                                                                      <i class="conum" data-value="4"></i><b>(4)</b>
    fifo: true                                                                          <i class="conum" data-value="5"></i><b>(5)</b>
    delaySeconds: 0                                                                     <i class="conum" data-value="6"></i><b>(6)</b>
    messageRetentionPeriod: 345600                                                      <i class="conum" data-value="7"></i><b>(7)</b>
    maximumMessageSize: 262144                                                          <i class="conum" data-value="8"></i><b>(8)</b>
    visibilityTimeout: 30                                                               <i class="conum" data-value="9"></i><b>(9)</b>

    queues:                                                                             <i class="conum" data-value="10"></i><b>(10)</b>
      test:                                                                             <i class="conum" data-value="11"></i><b>(11)</b>
        queue: TestQueue</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Queue prefix is prepended to every queue name (may be useful for local development)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Whether to create any missing queue automatically (default <code>false</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Whether to first fetch all queues and set up queue to url cache first time the service is prompted for the queue URL (default <code>false</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can specify the default topic for <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/sqs/SimpleQueueService.html">SimpleQueueService</a> and <code>@QueueClient</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Whether the newly created queues are supposed to be <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/FIFO-queues.html">FIFO queues</a> (default <code>false</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The length of time, in seconds, for which the delivery of all messages in the queue is delayed. Valid values: An integer from <code>0</code> to <code>900</code> (15 minutes). Default: <code>0</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The length of time, in seconds, for which Amazon SQS retains a message. Valid values: An integer representing seconds, from <code>60</code> (1 minute) to <code>1,209,600</code> (14 days). Default: <code>345,600</code> (4 days).</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The limit of how many bytes a message can contain before Amazon SQS rejects it. Valid values: An integer from <code>1,024</code> bytes (1 KiB) up to <code>262,144</code> bytes (256 KiB). Default: <code>262,144</code> (256 KiB).</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>The visibility timeout for the queue, in seconds. Valid values: an integer from <code>0</code> to <code>43,200</code> (12 hours). Default: <code>30</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>You can define multiple configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Each of the configuration can be access using <code>@Named('test') SimpleNotificationService</code> qualifier or you can define the configuration as <code>value</code> of <code>@NotificationClient('test')</code></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_publishing_with_queueclient">Publishing with <code>@QueueClient</code></h4>
<div class="paragraph">
<p>If you place <code>com.agorapulse.micronaut.aws.sqs.annotation.QueueClient</code> annotation on the interface then methods
matching predefined pattern will be automatically implemented. Methods containing word <code>delete</code> will delete queue messages.
Other methods of <code>QueueClient</code> will publish new records into the queue.</p>
</div>
<div class="paragraph">
<p>The following example shows many of available method signatures for publishing records:</p>
</div>
<div class="listingblock">
<div class="title">Publishing String Records</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">package com.agorapulse.micronaut.aws.sqs;

import com.agorapulse.micronaut.aws.Pogo;
import com.agorapulse.micronaut.aws.sqs.annotation.Queue;
import com.agorapulse.micronaut.aws.sqs.annotation.QueueClient;

@QueueClient                                                                            <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {

    @Queue(value = "OtherQueue", group = "SomeGroup")
    String sendMessageToQueue(String message);                                          <i class="conum" data-value="2"></i><b>(2)</b>

    String sendMessage(Pogo message);                                                   <i class="conum" data-value="3"></i><b>(3)</b>

    String sendMessage(byte[] record);                                                  <i class="conum" data-value="4"></i><b>(4)</b>

    String sendMessage(String record);                                                  <i class="conum" data-value="5"></i><b>(5)</b>

    String sendMessage(String record, int delay);                                       <i class="conum" data-value="6"></i><b>(6)</b>

    String sendMessage(String record, String group);                                    <i class="conum" data-value="7"></i><b>(7)</b>

    String sendMessage(String record, int delay, String group);                         <i class="conum" data-value="8"></i><b>(8)</b>

    void deleteMessage(String messageId);                                               <i class="conum" data-value="9"></i><b>(9)</b>

    String OTHER_QUEUE = "OtherQueue";
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@QueueClient</code> annotation makes the interface a SQS client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can specify to which queue is the message published using <code>@Queue</code> annotation, you can also specify the <code>group</code> for FIFO queues</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can publish any record object which can be converted into JSON.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can publish a byte array record</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can publish a string record</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can publish a string with custom delay</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can publish a string with custom FIFO queue group</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>You can publish a string with custom delay and FIFO queue group</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>You can delete published message using the message ID if the</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The return value of the publishing methods is message id returned by AWS.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, <code>QueueClient</code> publishes recoreds into the default queue defined by <code>aws.sns.queue</code> property.
You can switch to different configuration by changing the <code>value</code> of the annotation such as <code>@QueueClient("other")</code> or
by setting the <code>queue</code> property of the annotation such as <code>@QueueClient(queue = "SomeQueue")</code>. You can change queue
used by particular method using <code>@Queue</code> annotation as mentioned above.</p>
</div>
</div>
<div class="sect3">
<h4 id="_simple_queue_service">Simple Queue Service</h4>
<div class="paragraph">
<p><code>SimpleQueuenService</code> provides middle-level API for creating, describing, and deleting queues. It allows to publish, receive and delete records.</p>
</div>
<div class="paragraph">
<p>Instance of <code>SimpleQueueService</code> is created for the default SQS configuration and each queue configuration in <code>aws.sqs.queues</code> map.
You should always use <code>@Named</code> qualifier when injecting <code>SimpleQueueService</code> if you have more than one topic configuration present, e.g. <code>@Named("other") SimpleQueueService otherService</code>.</p>
</div>
<div class="paragraph">
<p>Following example shows some of the most common use cases for working with Amazon SQS.</p>
</div>
<div class="listingblock">
<div class="title">Creating Queue</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">String queueUrl = service.createQueue(TEST_QUEUE);                              <i class="conum" data-value="1"></i><b>(1)</b>

assertTrue(service.listQueueUrls().contains(queueUrl));                         <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new queue of given name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The queue URL is present within the list of all queues' URLs</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Describing Queue Attributes</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">Map&lt;String, String&gt; queueAttributes = service.getQueueAttributes(TEST_QUEUE);   <i class="conum" data-value="1"></i><b>(1)</b>

assertEquals("0", queueAttributes.get("DelaySeconds"));                         <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Fetch queue&#8217;s attributes</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can read the queue&#8217;s attributes from the map</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Delete Queue</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">service.deleteQueue(TEST_QUEUE);                                                <i class="conum" data-value="1"></i><b>(1)</b>

assertFalse(service.listQueueUrls().contains(queueUrl));                        <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Delete queue</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The queue URL is no longer present within the list of all queues' URLs</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Working with Messages</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">String msgId = service.sendMessage(DATA);                                       <i class="conum" data-value="1"></i><b>(1)</b>

assertNotNull(msgId);

List&lt;Message&gt; messages = service.receiveMessages();                             <i class="conum" data-value="2"></i><b>(2)</b>
Message first = messages.get(0);

assertEquals(DATA, first.getBody());                                            <i class="conum" data-value="3"></i><b>(3)</b>
assertEquals(msgId, first.getMessageId());
assertEquals(1, messages.size());

service.deleteMessage(msgId);                                                   <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Send a message</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Receive messages from the queue (in another application)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Read message body</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Developers are responsible to delete the message from the queue themselves</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Try to use AWS Lambda functions triggered by SQS messages to handle incoming SQS messages instead of implementing
complex message handling logic yourselves.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please, see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/sqs/SimpleQueueService.html">SimpleQueueService</a> for the full reference.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_6">Testing</h4>
<div class="paragraph">
<p>You can very easily mock any of the interfaces and declarative services but if you need close-to-production
SQS integration works well with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a>.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code>compile group: 'org.testcontainers', name: 'localstack', version: '1.10.2'
compile group: 'org.testcontainers', name: 'spock', version: '1.10.2'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;localstack&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;spock&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can setup your tests like this:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Testcontainers                                                                         <i class="conum" data-value="1"></i><b>(1)</b>
@RestoreSystemProperties                                                                <i class="conum" data-value="2"></i><b>(2)</b>
class SimpleQueueServiceSpec extends Specification {

    @Shared LocalStackContainer localstack = new LocalStackContainer('0.8.8')           <i class="conum" data-value="3"></i><b>(3)</b>
        .withServices(SQS)

    @AutoCleanup ApplicationContext context                                             <i class="conum" data-value="4"></i><b>(4)</b>

    SimpleQueueService service

    void setup() {
        System.setProperty('com.amazonaws.sdk.disableCbor', 'true')                     <i class="conum" data-value="5"></i><b>(5)</b>
        AmazonSQS sqs = AmazonSQSClient                                                 <i class="conum" data-value="6"></i><b>(6)</b>
            .builder()
            .withEndpointConfiguration(localstack.getEndpointConfiguration(SQS))
            .withCredentials(localstack.defaultCredentialsProvider)
            .build()

        context = ApplicationContext.build('aws.sqs.queue': TEST_QUEUE).build()         <i class="conum" data-value="7"></i><b>(7)</b>
        context.registerSingleton(AmazonSQS, sqs)
        context.start()

        service = context.getBean(SimpleQueueService)                                   <i class="conum" data-value="8"></i><b>(8)</b>
    }

    // tests

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@Testcontainers</code> to let Spock manage the Testcontainers for you</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@RestoreSystemProperties</code> will guarantee that system properties will be restore after the test</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with SQS support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code>, <code>@AutoCleanup</code> guarantees closing the context after the tests</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Disable CBOR protocol for SQS (not supported by the mock implementation)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Create <code>AmazonSQS</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Prepare the application context with required properties and service using LocalStack</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>You can obtain instance of <code>SimpleQueueService</code> from the context</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class SimpleNotificationServiceTest {

    public ApplicationContext context;                                                  <i class="conum" data-value="1"></i><b>(1)</b>

    public SimpleQueueService service;

    @Rule
    public LocalStackContainer localstack = new LocalStackContainer("0.8.8")            <i class="conum" data-value="2"></i><b>(2)</b>
        .withServices(SQS);

    @Before
    public void setup() {
        System.setProperty("com.amazonaws.sdk.disableCbor", "true");                    <i class="conum" data-value="3"></i><b>(3)</b>

        AmazonSQS amazonSQS = AmazonSQSClient                                           <i class="conum" data-value="4"></i><b>(4)</b>
            .builder()
            .withEndpointConfiguration(localstack.getEndpointConfiguration(SQS))
            .withCredentials(localstack.getDefaultCredentialsProvider())
            .build();


        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();                               <i class="conum" data-value="5"></i><b>(5)</b>
        properties.put("aws.sqs.queue", TEST_QUEUE);


        context = ApplicationContext.build(properties).build();                         <i class="conum" data-value="6"></i><b>(6)</b>
        context.registerSingleton(AmazonSQS.class, amazonSQS);
        context.start();

        service = context.getBean(SimpleQueueService.class);
    }

    @After
    public void cleanup() {
        System.clearProperty("com.amazonaws.sdk.disableCbor");

        if (context != null) {
            context.close();                                                            <i class="conum" data-value="7"></i><b>(7)</b>
        }
    }

    // tests

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with SQS support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Disable CBOR protocol for SQS (not supported by the mock implementation)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create <code>AmazonSQS</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Prepare required properties</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Prepare the application context with required properties and service LocalStack</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Close the application context after the test</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_maintained_by">Maintained by</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<a class="image" href="https://www.agorapulse.com/"><img src="https://cloud.githubusercontent.com/assets/139017/17053391/4a44735a-5034-11e6-8e72-9f4b7139d7e0.png" alt="4a44735a 5034 11e6 8e72 9f4b7139d7e0"></a>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-01-08 13:42:54 +0100
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>